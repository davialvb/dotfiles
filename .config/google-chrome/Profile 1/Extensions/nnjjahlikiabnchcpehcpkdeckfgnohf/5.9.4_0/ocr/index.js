const ocr_table_parse_url="ocr/table",ocr_general_url="ocr/general",imageUrl="https://cbu01.alicdn.com/img/ibank/O1CN01ybHlO41wuapn52P9J_!!3267756368-0-cib.jpg",imageUrl1="https://cbu01.alicdn.com/img/ibank/O1CN01DszJNz1Hv946yUmUZ_!!3833060819-0-cib.jpg",imageUrl2="https://image.52daogou.com/FpeUj4AGtTNzifWzI0XeEvqR9Hsh";var params=utils.parseParams(location.href);function jumpToLoginPage(){location.href=`${gConfig.lbWebServer}/#/login?jumpto=${encodeURIComponent(location.href)}`}var app=new Vue({el:"#app",data:{userInfo:null,imageUrl:"",tables:[],rets:[],imgWidth:0,imgHeight:0,type:OCR_TYPE_ALI_TABLE,error:null,lbToken:"",brand:gConfig.brand,imgZoomOuted:!1,showImg:!!params.imageUrl},watch:{error(){this.error&&401==this.error.statusCode?jumpToLoginPage():this.error&&this.$message.error(this.error.message)}},mounted(){chrome.storage.local.get("lbToken",e=>{e.lbToken?(this.lbToken=e.lbToken,document.getElementById("source-img").onload=this.imgOnload,this.imageUrl=params.imageUrl,this.type=params.type||this.type,this.type=parseInt(this.type),this.imageUrl&&this.ocr()):jumpToLoginPage()}),window.addEventListener("click",e=>{"source-img"==e.target.id&&(this.imgZoomOuted=!this.imgZoomOuted)})},methods:{reset(){this.tables=[],this.rets=[]},getBaseRow(e){for(var t=0,r=0,a=0;a<e.length;a++)e[a].length>r&&(r=e[a].length,t=a);return e[t]},ocr(){switch(this.type){case OCR_TYPE_ALI_TABLE:return this.tableParse();default:return this.ocrGeneral()}},ocrGeneralH(){this.type=OCR_TYPE_ALI_GENERAL,history.pushState({},document.title,`?type=${OCR_TYPE_ALI_GENERAL}&imageUrl=${this.imageUrl}`),this.ocrGeneral()},tableParseH(){this.type=OCR_TYPE_ALI_TABLE,history.pushState({},document.title,`?type=${OCR_TYPE_ALI_TABLE}&imageUrl=${this.imageUrl}`),this.tableParse()},ocrParse(e){return this.reset(),utils.toDataURL(this.imageUrl).then(t=>{var r=md5(t);return fetch(`${gConfig.lbServer}/${e==OCR_TYPE_ALI_TABLE?"ocr/table":"ocr/general"}?imageUrl=${encodeURIComponent(this.imageUrl)}&md5=${r}`,{headers:{Authorization:`Bearer ${this.lbToken}`}}).then(e=>e.json()).then(e=>{if(e.error)throw this.error=e.error,new Error(this.error.message);return JSON.parse(e.data)})})},tableParse(){this.ocrParse(OCR_TYPE_ALI_TABLE).then(e=>{this.tables=e.tables.map(e=>e.slice(1,e.length-1))})},ocrGeneral(){this.ocrParse(OCR_TYPE_ALI_GENERAL).then(e=>{this.rets=e.ret})},getStyleFromRet(e){var t=e.rect,r={top:`${t.top}px`,left:`${t.left}px`};return r},imgOnload(e){this.imgWidth=e.target.width,this.imgHeight=e.target.height},arraySpanMethod({row:e,column:t,rowIndex:r,columnIndex:a}){var i=e[a];return i?[i.ey-i.sy,i.ex-i.sx]:[0,0]},getI18n:utils.getI18n}});