if(navigator.userAgent.match("Firefox")){var storageLocalSet=chrome.storage.local.set;chrome.storage.local.set=function(e,t){storageLocalSet.apply(chrome.storage.local,[e,t])}}var autoConvertWebp=1;chrome.storage.local.get("options_config",function(e){var t=e.options_config;t&&0===t.autoConvertWebp&&(autoConvertWebp=0)}),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+{0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"}[this.getDay()+""])),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e};var utils=function(){var e;return{param:function(e){var t=[];for(var r in e)t.push(r+"="+encodeURIComponent(e[r]));return t.join("&")},parseParams:function(e){var t=e.substr(e.indexOf("?")+1),r={};return(t=t.split("&")).forEach(e=>{e=e.split("="),r[e[0]]=decodeURIComponent(e[1])}),r},parseJSON:function(e){if("string"!=typeof e)return e;var t;try{t=jQuery.parseJSON(e)}catch(r){t=Function(e)()}return t},cleanImgUrl:function(e){return e.replace(/_\.webp$/,"")},fileOrBlobToDataURL:function(e,t){var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}},blobToImage:function(e,t){utils.fileOrBlobToDataURL(e,function(e){var r=new Image;r.onload=function(){t(r)},r.src=e})},dataURLToBlob:function(e){for(var t=e.split(","),r=t[0].match(/:(.*?);/)[1],n=atob(t[1]),a=n.length,o=new Uint8Array(a);a--;)o[a]=n.charCodeAt(a);return new Blob([o],{type:r})},compareVersion:function(e,t){for(var r=e.split(".").map(function(e){return parseInt(e)}),n=t.split(".").map(function(e){return parseInt(e)}),a=0;a<r.length;a++)if(r[a]!=n[a])return void 0!==n[a]?r[a]-n[a]:1;return r.length<n.length?-1:0},getBlobAndContentType:function(e,t){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var e=r.getResponseHeader("Content-Type")||"image/jpeg";e=e.split(";")[0].split(",")[0].split("/")[1];var n=window.URL.createObjectURL(r.response);t({success:!0,data:{blobUrl:n,contentType:e}})},r.onerror=function(){t({success:!1,msg:"xhr error"})};try{r.open("GET",e,!0),r.send()}catch(e){t({success:!1,msg:"Invalid uri"})}},loadImageAsBlob:function(e,t){"function"!=typeof t&&(t=function(e){});var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var n="",a="",o=r.getResponseHeader("Content-Type");if(o){a=o.split(";")[0].split(",")[0].split("/")[1];var s={dataUrl:n=window.URL.createObjectURL(r.response),src:e},l=new Image;l.onload=function(){var e=parseInt(this.naturalWidth),r=parseInt(this.naturalHeight);if(s.width=e,s.height=r,autoConvertWebp&&"webp"==a){var n=document.createElement("canvas");n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0);var o=s.src.split(".");s.ext||o[o.length-1].toLowerCase();s.dataUrl=n.toDataURL("image/jpeg"),a="jpg"}s.ext=s.ext||a||"",t({success:!0,item:s})},l.onerror=function(){s.width=1,s.height=1,t({success:!1,item:s})},l.src=n}else t({success:!1})},r.open("GET",e,!0),r.send()},getDomainFromUrl:function(e){var t=e.match("://(.*?)/");return t?t[1]:""},replaceVarible:function(e){var t=e.text;if(t=(t=t.replace(/\{PAGETITLE\}/g,e.pageTitle||"")).replace(/\{DATE\}/g,(new Date).Format("yyyyMMdd_HHmmss")),null!=e.name&&(t=t.replace(/\{NAME\}/g,e.name)),null!=e.ext&&(t=t.replace(/\{EXT\}/g,e.ext)),null!=e.link&&(t=t.replace(/\{LINK\}/g,e.link)),null!=e.index){var r=(t=t.replace(/\{NO\}/g,e.index)).match(/\{NO([\d]+)\}/);if(r){var n=r[1],a=n.length,o=e.index+parseInt(n);(""+o).length<a&&(o=("000000000000000000000000000000"+o).substr(-a)),t=t.replace(/\{NO([\d]+)\}/g,o)}}return t},checkTabDownloadableByUrl:function(e){return!e.match(/^(chrome)/)},getInfoFromBlob:function(e,t){var r=e.contentType;r&&(r=r.split(";")[0]);var n=new Image,a={};n.onload=function(){if(a.ext="octet-stream"==r?"":r,a.width=n.naturalWidth,a.height=n.naturalHeight,_config.autoConvertWebp&&"webp"==r){var o=utils.getJpgPngDataUrlFromWebp(n,e.bigUrl);a.jpgPngDataUrl=o.jpgPngDataUrl,a.ext=o.ext||a.ext}t({success:!0,data:a})},n.src=e.blobUrl},getJpgPngDataUrlFromWebp:function(e,t){var r=document.createElement("canvas");r.width=e.naturalWidth,r.height=e.naturalHeight,r.getContext("2d").drawImage(e,0,0);var n=t.split("."),a=n[n.length-1].toLowerCase();a.replace(/[?#].*/,"");return{jpgPngDataUrl:r.toDataURL("image/jpeg"),ext:"jpg"}},getAllBgImages:function(){var e,t=[],r=document.getElementsByTagName("*");for(r=t.slice.call(r,0,r.length);r.length;)(e=utils.deepCss(r.shift(),"background-image"))&&(e=/url\(['"]?([^")]+)/.exec(e)||[]),(e=e[1])&&!e.match(/:\/\//)&&(e=e.match(/^\/\//)?location.protocol+e:e.match(/^\/[^/]/)?location.protocol+"//"+location.host+e:location.href.replace(/[^/]+$/,e)),e&&-1==t.indexOf(e)&&(t[t.length]=e);return t},deepCss:function(e,t){if(!e||!e.style)return"";var r=t.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()});if(e.currentStyle)return e.style[r]||e.currentStyle[r]||"";var n=document.defaultView||window;return e.style[r]||n.getComputedStyle(e,"").getPropertyValue(t)||""},translateUrl:function(e){var t=[],r=[],n=/\d+-\d+/,a=e.match(/^(.*)\[(.*?)\](.*)$/);if(a){for(var o=a[1],s=a[2],l=a[3],i=s.split(","),c=0;c<i.length;c++){var u=i[c];if(u.indexOf("-")>0){var g=u.split("-")[0],p=u.split("-")[1];if(n.test(u))for(var h=parseInt(g);h<=parseInt(p);h++)r.push("00000".substr(0,g.length-(""+h).length)+h);else for(var f=g.charCodeAt(0);f<=p.charCodeAt(0);f++)r.push(String.fromCharCode(f))}else r.push(u)}for(c=0;c<r.length;c++)t.push(o+r[c]+l)}else e.match(/^https?:\/\/.*$/)&&t.push(e);return t},offset:function(e,t){for(var r="offset"+t[0].toUpperCase()+t.substring(1),n=e[r],a=e.offsetParent;null!=a;)n+=a[r],a=a.offsetParent;return n},getI18n:function(t){return e=e||JSON.parse(localStorage.defaultMessages),chrome.i18n.getMessage(t)||(e[t]?e[t].message:"")},PrefixZero:function(e,t){return(Array(t).join(0)+e).slice(-t)},getSafeDir:function(e){return e=(e=(e=(e=(e=(e=e.replace(/^ +/,"")).replace(/ +$/,"")).replace(/ /g,"_yythkg_")).replace(/[~|\\:*?"'<>=%$@#+;,!\^\s]/g,"_").replace(/\.+$/g,"").substr(0,100)).replace(/_yythkg_/g," ")).replace(/\s+$/,"")},param:function(e){var t=[];for(var r in e)t.push(r+"="+e[r]);return t.join("&")},toDataURL:function(e){return fetch(e).then(e=>e.blob()).then(e=>new Promise((t,r)=>{const n=new FileReader;n.onloadend=(()=>t(n.result)),n.onerror=r,n.readAsDataURL(e)}))}}}();