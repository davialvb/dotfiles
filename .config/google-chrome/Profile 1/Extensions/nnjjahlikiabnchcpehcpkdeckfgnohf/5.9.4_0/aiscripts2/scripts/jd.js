function aiparser(e){function t(e,t){return(Array(t).join(0)+e).slice(-t)}var a={main_pic:[],video:[],sku:[],detail:[]};var n=[];chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]});var o=1;document.querySelectorAll("#spec-list img").forEach(function(e){e.src.replace(/\/n\d+\//,"/imgzone/").replace(/s\d+x\d+_jfs/,"jfs").replace(/!cc_50x64.jpg$/,""),n.push({src:e.src.replace(/^(https?:)/,"https:"),group:"主图",groupIndex:0,alt:"主图-"+t(o++,2)})});var i=1;document.querySelectorAll("#choose-attrs img").forEach(function(e){n.push({src:e.src,group:"SKU图片",groupIndex:2,alt:"SKU-"+t(i++,2)})});var c=1,r=document.createElement("script");r.innerText="localStorage.fatkun_pageConfig = JSON.stringify({\n            videoData: window.pageConfig.product.videoData,\n            desc: window.pageConfig.product.desc\n        });",document.body.appendChild(r);var s=JSON.parse(localStorage.fatkun_pageConfig);s.videoData&&s.videoData.playUrl&&(a.video.push(s.videoData.playUrl),n.push({type:"VIDEO",src:s.videoData.playUrl,group:"视频",groupIndex:1})),chrome.runtime.sendMessage({cmd:"NET",settings:{url:s.desc.replace(/^.*?\/\//,"https://"),dataType:"text"}},e=>{var o=e.data;try{o=JSON.parse(e.data).content}catch(e){}var i=o.match(/(http:)?\/\/img\d*?\.360buyimg\.com.*?.(jpg|png|jpeg)/g);i&&i.forEach(e=>{e.match("^//")&&(e=location.protocol+e),n.push({src:e,group:"详情",groupIndex:3,alt:"详情-"+t(c++,2)})}),n.forEach(e=>{e.src=e.src.replace(".avif","")}),chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:n}),_config.recordPageInfo&&(n.forEach(e=>{var t=bigImgParser.parse(e.src);switch(e.group){case"主图":a.main_pic.push(t);break;case"SKU图片":a.sku.push(t);break;case"详情":a.detail.push(t)}}),chrome.runtime.sendMessage({cmd:"SET_PAGE_INFO",pageInfo:"IMAGES JSON DATA:\r\n"+JSON.stringify(a)}))})}window.aiparser=aiparser,window.extras={downloadMJX:function(){var e,t,a,n=0,o=!1,i="video";function c(e){return e.match(/^http/)||(e=location.protocol+e),e}function r(t){n++;var o=document.createElement("script");o.src=`https://club.jd.com/discussion/getProductPageImageCommentList.action?productId=${e}&isShadowSku=0&callback=${a}&page=${n}&pageSize=10&_=${Date.now()}`,document.body.appendChild(o)}function s(a){n++;var o=document.createElement("script");o.src=`https://club.jd.com/comment/productPageComments.action?callback=${t}&productId=${e}&score=7&sortType=6&page=${n}&pageSize=10&isShadowSku=0&fold=1`,document.body.appendChild(o)}!function(){e=location.href.match("/(\\d+).html")[1],t=`jsonp${parseInt(1e4*Math.random())}`,a=`jsonpimage${parseInt(1e4*Math.random())}`;var d=document.createElement("script");d.innerText=`\n        window.${t} = function(data){\n            window.postMessage({\n                topic: 'fatkun-tbview',\n                data: data\n            }, '*')\n        };\n        window.${a} = function(data){\n            window.postMessage({\n                topic: 'fatkun-tbview-image',\n                data: data\n            }, '*')\n        };\n    `,document.body.append(d),window.addEventListener("message",function(e){"fatkun-tbview"==e.data.topic?function(e){var t;e.comments&&e.comments.length>0?(e.comments.forEach((e,t)=>{(e=e).images&&chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:e.images.map(t=>({src:c(t.imgUrl),alt:`${e.id}-${t.id}`}))}),e.videos&&chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:e.videos.map(t=>({src:c(t.remark),alt:`${e.id}-${t.id}`,type:"VIDEO"}))})}),o||setTimeout(s.bind(this,n),2e3)):(i="image",r(n=0))}(e.data.data):"fatkun-tbview-image"==e.data.topic&&function(e){e.imgComments&&e.imgComments.imgList&&e.imgComments.imgList.length>0?(chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:e.imgComments.imgList.map(e=>({src:c(e.imageUrl),alt:`${e.commentVo.id}-${e.imageId}`}))}),o||setTimeout(r.bind(this,n),2e3)):chrome.runtime.sendMessage({cmd:"COLLECT_COMPLETED"})}(e.data.data)})}(),chrome.runtime.sendMessage({cmd:"OPEN-OUTPUT",type:"ftk-tb-review"},function(){setTimeout(function(){chrome.runtime.sendMessage({cmd:"SUPPORT_COLLECT_PAUSE"}),s()},2e3)}),chrome.runtime.onMessage.addListener(function(e){"PAUSE_COLLECT"==e.cmd?o=!0:"RESUME_COLLECT"==e.cmd&&(o=!1,"image"==i?r():s())})}};