var h_if_none_match="If-None-Match-";function aiparser(e){if(window==top){var t,o=[],n=location.href.match(/i\.(\d+)\.(\d+)/);if(n||(n=location.href.match(/product\/(\d+)\/(\d+)/)),t=location.href.match("shopee.tw")?"cf.shopee.tw":"s-cf-tw.shopeesz.com",n){chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片"]});var i=n[2],a=n[1],r=1,c=1,s=[],h={};localStorage[h_if_none_match+n[2]]&&(h.headers={"if-none-match-":localStorage[h_if_none_match+n[2]]}),fetch(`https://${location.host}/api/v4/item/get?itemid=${i}&shopid=${a}`,h).then(e=>e.json()).then(e=>{e.data.images.forEach(e=>{s.push({src:`https://${t}/file/${e}`,group:"主图",groupIndex:0,alt:"主图-"+p(r++,2)})}),e.data.tier_variations.forEach(e=>{e.images&&e.images.forEach((o,n)=>{s.push({src:`https://${t}/file/${o}`,group:"SKU图片",groupIndex:2,alt:`SKU-${e.options[n]||""}`+p(c++,2)})})}),e.data.video_info_list&&e.data.video_info_list.forEach(e=>{s.push({src:`https://${t}/file/${e.thumb_url}`,group:"视频",groupIndex:1,alt:"视频封面"}),s.push({type:"VIDEO",src:`https://cvf.shopee.tw/file/${e.video_id}`,group:"视频",groupIndex:1})}),chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:s})})}else{o=[];document.querySelectorAll("img").forEach(function(e){o.push({src:e.src.replace(/_tn$/,"")})}),chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:o})}}function p(e,t){return(Array(t).join(0)+e).slice(-t)}}!function(){var e=`\n        var _fetch = fetch;\n        fetch = function(url, options){\n            console.log(url);\n            console.log(options);\n            var itemid = url.match('api/v2/item/get\\\\?itemid=(\\\\d+)');\n            if(itemid && options['headers'] && options['headers']['${h_if_none_match}']){\n                localStorage['${h_if_none_match}'+itemid[1]] = options['headers']['${h_if_none_match}'];\n            }\n            return _fetch.apply(window, arguments);\n        }\n    `,t=document.createElement("script");t.innerText=e,document.documentElement.appendChild(t)}(),window.aiparser=aiparser;