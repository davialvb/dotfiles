function aiparser(tabInfo){if(top==self){var index=0;chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]});var itemImgs=document.querySelectorAll("#J_UlThumb img"),colorImgs=document.querySelectorAll(".J_TSaleProp a"),descImgs=document.querySelectorAll("#description img");location.href.match("h5.m.taobao.com")&&(itemImgs=document.querySelectorAll(".siema-wrapper img"),descImgs=document.querySelectorAll(".detail-desc img"));var mainIndex=1;itemImgs.forEach(function(e){e.src.match(/tbvideo.jpg/)||send({alt:"主图-"+PrefixZero(mainIndex++,2),src:e.dataset.src||e.src,group:"主图",groupIndex:0})});var colorIndex=1;colorImgs.forEach(function(e){var t=e.style.backgroundImage.match(/(\/\/.*)"/);t&&send({src:t=t=location.protocol+t[1],group:"SKU图片",groupIndex:2,alt:"SKU-"+PrefixZero(colorIndex++,2)+"-"+$(e).find("span").text()})});var detailIndex=1;descImgs.forEach(function(e){var t=e.dataset.src||e.dataset.ksLazyload||e.src;t.match("img-tmdetail.alicdn.com/tps/i3/T1BYd_XwFcXXb9RTPq-90-90.png")||t.match("spaceball.gif")||send({alt:"详情-"+PrefixZero(detailIndex++,2),src:t,group:"详情",groupIndex:3})});var meta=document.querySelector('meta[name="microscope-data"]'),scripts=document.querySelectorAll("script"),imgVedioID;if(meta&&(userId=meta.content.match(/userid=(\d+);/),userId)){userId=userId[1];for(var i=0;i<scripts.length;i++)if(scripts[i].innerText&&!imgVedioID&&(imgVedioID=scripts[i].innerText.match(/"videoId":"(\d+)"/),imgVedioID)){imgVedioID=imgVedioID[1];var videoUrl="https://cloud.video.taobao.com/play/u/"+userId+"/p/1/e/6/t/1/"+imgVedioID+".mp4";new VItem({src:videoUrl,group:"视频",groupIndex:1,alt:"视频"},index++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:_tabInfo.id,item:e})});break}}if(location.href.match("new.m.taobao.com/detail.htm")){let imgs=[];eval(document.querySelector('[data-from="server"]').innerText);let initialProps=window.__INITIAL_DATA__.pageInitialProps;initialProps.item.images.forEach((e,t)=>{imgs.push({src:e,group:"主图",alt:"主图-"+PrefixZero(t+1,2)})}),initialProps.item.videos&&initialProps.item.videos.forEach((e,t)=>{imgs.push({src:e.url,type:"VIDEO",group:"视频"}),imgs.push({src:e.videoThumbnailURL,group:"视频",alt:"视频封面"})});try{initialProps.skuBase.props[0].values.forEach((e,t)=>{imgs.push({src:e.image,alt:"SKU-"+PrefixZero(t+1,2)+"-"+e.name,group:"SKU图片"})}),document.querySelectorAll(".xxx-sku-img").forEach((e,t)=>{imgs.push({src:e.src,alt:"SKU-"+PrefixZero(t+1,2),group:"SKU图片"})})}catch(e){}chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:imgs}),chrome.runtime.sendMessage({cmd:"NET",settings:{url:initialProps.item.moduleDescUrl.replace(/.*\/\//,"https://")}},e=>{if("ok"==e.status){let t=[];e.data.data.children.forEach((e,n)=>{e.params&&e.params.picUrl&&t.push(e.params.picUrl)}),chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:t.map((e,t)=>({src:e,group:"详情",alt:"详情-"+PrefixZero(t+1,2)}))})}})}}function PrefixZero(e,t){return(Array(t).join(0)+e).slice(-t)}function send(e){e.src.match("^//")&&(e.src=location.protocol+e.src),new ParsedPItem(e,index++,_tabInfo,function(e){e.width>100&&chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})}}!function(){window.ftk_docTitle=document.title.replace("-淘宝网","");var e=location.href.match(/\bid=(\d+)/);e&&(window.ftk_docTitle=`${e[1]}-${window.ftk_docTitle}`,window.ftk_itemId=e[1])}(),window.aiparser=aiparser,function(){var e,t,n,r,a,i,o=1,c=0,s=!1,d=!1;function m(){n=location.href.match("\\bid=(\\d+)")[1],r=document.getElementsByName("microscope-data")[0].content.match(/userid=(\d+)/)[1];for(var o=document.querySelectorAll("script"),s=0;s<o.length;s++)if(a=o[s].innerText.match(/"spuId":"(\d+)"/)){a=a[1];break}i=`jsonp${parseInt(1e4*Math.random())}`;var m=document.createElement("script");m.innerText=`\n        window.${i} = function(data){\n            window.postMessage({\n                topic: 'fatkun-tbview',\n                data: data\n            }, '*')\n        };\n    `,document.body.append(m),window.addEventListener("message",function(n){"fatkun-tbview"==n.data.topic&&function(n){if(n.comments){var r=n.currentPageNum;n.comments.forEach((e,t)=>{!function e(t,n,r){var a=`第${r}页-第${n+1}条评论 <${t.auction?t.auction.sku:""}>`;t.photos.forEach((e,t)=>{new ParsedPItem({src:u(e.url),alt:`${r}-${n+1}-图片-${t+1}`,group:a,groupIndex:20*(r-1)+n},c++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_IMG",type:"ftk-tb-review",tabId:_tabInfo.id,item:e})})});var i=[];t.video&&i.push(t.video);i=i.concat(t.videos||[]);i.forEach((e,t)=>{new VItem({src:u(e.cloudVideoUrl),group:a,alt:`${r}-${n+1}-${t+1}-视频`,groupIndex:20*(r-1)+n},c++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",type:"ftk-tb-review",tabId:_tabInfo.id,item:e})}),new ParsedPItem({src:u(e.coverUrl),group:a,alt:`${r}-${n+1}-${t+1}-视频封面`,groupIndex:20*(r-1)+n},c++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_IMG",type:"ftk-tb-review",tabId:_tabInfo.id,item:e})})});t.append&&e(t.append,n,r)}(e,t,r)})}(!t||e<t)&&(e++,d||setTimeout(l.bind(this,e),5e3));e!=t&&n.currentPageNum!=n.maxPage||chrome.runtime.sendMessage({cmd:"COLLECT_COMPLETED"})}(n.data.data)})}function u(e){if(!e.match(/^http/))return location.protocol+e}function l(e){var t=document.createElement("script"),a=`${Date.now()}_${parseInt(1e4*Math.max(.1,Math.random()))}`,o=Math.random();t.src=`https://rate.taobao.com/feedRateList.htm?auctionNumId=${n}&userNumId=${r}&currentPageNum=${e}&pageSize=20&rateType=3&orderType=sort_weight&attribute=&sku=&hasSku=true&folded=0&ua=${o}&_ksTS=${a}&callback=${i}`,document.body.appendChild(t)}c=0;var p=0,f=setInterval(function(){p>20&&clearInterval(f),p++,$('a[shortcut-label="查看累计评论"]').length>0&&0==$("#ftk-review-download-btn").length&&($(`<li class="item-desc-tabview-item" style="cursor: default;display: flex; align-items: center;">\n                <button id="ftk-review-download-btn" style="cursor: pointer;">\n                    <img style="width:16px;vertical-align:middle;margin-right:4px;" src="${chrome.extension.getURL("/icon-small.png")}"/>\n                    <span>下载</span>\n                </button>\n                <span>第</span>\n                <input id="fatkun-review-page-input-from" type="number" value="1" style="width: 4em"/>\n                <span>到</span>\n                <input id="fatkun-review-page-input-to" type="number" value="10" style="width: 4em"/>\n                <span>页评论图片</span>\n            </li>`).insertAfter($('a[shortcut-label="查看累计评论"]').closest("li")).find("button").click(function(){o=document.getElementById("fatkun-review-page-input-from").value,o=parseInt(o),t=document.getElementById("fatkun-review-page-input-to").value,t=parseInt(t),g()}),clearInterval(f))},500);function g(){return s||(m(),s=!0),e=o,chrome.runtime.sendMessage({cmd:"OPEN-OUTPUT",type:"ftk-tb-review"},function(){setTimeout(function(){chrome.runtime.sendMessage({cmd:"SUPPORT_COLLECT_PAUSE"}),l(e)},2e3)}),chrome.runtime.onMessage.addListener(function(t){"PAUSE_COLLECT"==t.cmd?d=!0:"RESUME_COLLECT"==t.cmd&&(d=!1,l(e))}),!1}window.extras={downloadMJX:function(){g()}}}();