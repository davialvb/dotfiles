function aiparser(e){if(top==self){var t=0;if(location.href.match("www.dhgate.com")){var o=document.querySelectorAll("#simgList li, .simg-list li"),n=document.querySelectorAll(".color-list img"),r=document.querySelectorAll(".product-details img, .ec-img-lis img");o.forEach(function(e){i({src:e.getAttribute("b-init")?e.getAttribute("b-init"):$(e).find("img").attr("src"),group:"主图",groupIndex:0})}),n.forEach(function(e){i({src:e.src,group:"SKU图片",groupIndex:2})}),r.forEach(function(e){i({src:e.src,group:"详情",groupIndex:3})})}else document.querySelectorAll("img").forEach(function(t,o){new ParsedPItem(t,o,e,function(t){chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:e.id,item:t})})})}function i(o){o.src.match(/^\/\//)&&(o.src=location.protocol+o.src),new ParsedPItem(o,t++,e,function(t){chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:e.id,item:t})})}}window.aiparser=aiparser,window.downloadReview=function(e){if(top==window){var t=1,o=location.href.match("(\\d+)\\.html")[1],n=!1,r=[];chrome.runtime.sendMessage({cmd:"OPEN-OUTPUT",type:"ftk-tb-review"},function(){setTimeout(function(){chrome.runtime.sendMessage({cmd:"SUPPORT_COLLECT_PAUSE"}),i(t)},2e3)}),chrome.runtime.onMessage.addListener(function(e){"PAUSE_COLLECT"==e.cmd?n=!0:"RESUME_COLLECT"==e.cmd&&(n=!1,i(t))})}function i(c){t++,fetch(`https://www.dhgate.com/prod/ajax/comment.do?itemCode=${o}&language=en&client=pc&dispCurrency=USD&sortType=1&pageNum=${c}&pageSize=10${"withImg"==e?"&onlyHaveImg=1":""}`).then(e=>e.json()).then(e=>{!function(e){if(e.data.length>0){var o=[];e.data.filter(e=>5==e.score).forEach(e=>{r.push(`${(s=e).reviewid} ${s.prodAttrs?s.prodAttrs.map(e=>e.attrname+":"+e.attrvalue).join(" "):""}\r\n${s.content}\r\n`),e.tdAttachDto&&e.tdAttachDto.imgMap&&Object.keys(e.tdAttachDto.imgMap).forEach(t=>{o.push({src:e.tdAttachDto.imgMap[t].replace(/.*\/\//,location.protocol+"//"),alt:`${e.reviewid}-${t}`})})}),chrome.runtime.sendMessage({cmd:"ADD_IMG_LIST",list:o}),n||setTimeout(i.bind(this,t),2e3)}else{chrome.runtime.sendMessage({cmd:"COLLECT_COMPLETED"}),chrome.runtime.sendMessage({cmd:"SET_EXTRA_INFO",extraInfo:""});var c=new Blob(["评论 - reviews：\r\n","Page Url:\r\n",location.href,"\r\n"].concat(r.join("\r\n")),{type:"text/plain"}),a=window.URL.createObjectURL(c),d=document.createElement("a");d.href=a,d.setAttribute("download",`dhgate-reviews-${document.title}.txt`),d.click()}var s}(e.data)}),chrome.runtime.sendMessage({cmd:"SET_EXTRA_INFO",extraInfo:`正在采集第 ${t} 页评论`})}},window.extras={downloadAllReviews:function(){downloadReview("all")},downloadMJX:function(){downloadReview("all")}};